/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Document selectors///////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const chronoSelector = document.querySelectorAll('.chrono');
chronoSelector.forEach((element) => {
	element.addEventListener('click', chronoOnClick);
});

const section = document.querySelector('.section-info');

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Initial state////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

let timeframe = 'daily'; /// default starting value;

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Download JSON////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
let data = {};

fetch('./data.json').then((resp) => resp.json()).then((jsonData) => {
	jsonData.forEach((element) => {
		section.insertAdjacentHTML('beforeend', createRegularCard(element, timeframe));
	});

	jsonData.forEach((element) => {
		data[element.title] = element.timeframes;
	});

	regularCards = document.querySelectorAll('.item');
});

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Event Handler////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function chronoOnClick(event) {
	timeframe = event.target.innerText.toLowerCase();
	chronoSelector.forEach((element) => {
		element.classList.remove('chrono-active');
	});

	event.target.classList.add('chrono-active');

	updateCards(timeframe);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Update Functions/////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function updateCards(timeframe) {
	regularCards.forEach((card) => {
		updateCard(card, timeframe);
	});
}

function updateCard(card, timeframe) {
	const title = card.querySelector('.title').innerText;
	const current = data[title][timeframe]['current'];
	const previous = data[title][timeframe]['previous'];

	const timeFrameMSG = {
		daily: 'Yesterday',
		weekly: 'Last Week',
		monthly: 'Last Month'
	};

	const hoursElement = card.querySelector('.hours');
	hoursElement.innerText = `${current}hrs`;
	const msgElement = card.querySelector('.description');

	msgElement.innerText = `${timeFrameMSG[timeframe]} - ${previous}hrs`;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Create Html//////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function createRegularCard(element, timeframe) {
	let title = element['title'];
	let current = element['timeframes'][timeframe]['current'];
	let previous = element['timeframes'][timeframe]['previous'];

	const timeFrameMSG = {
		daily: 'Yesterday',
		weekly: 'Last Week',
		monthly: 'Last Month'
	};

	return ` <div class="item item-${title.toLowerCase().replace(/\s/g, '')}">
    <div class="block">
      <div class="heading">
        <h3 class="title">${title}</h3>
        <img class="options" src="images/icon-ellipsis.svg" alt="Options">
      </div>
    <div class="data">
      <h1 class="hours">${current}${current < 2 ? 'hr' : 'hrs'}</h1>
      <p class="description">${timeFrameMSG[timeframe]} - ${previous}${previous < 2 ? 'hr' : 'hrs'}</p>
    </div>
    </div>
  </div>`;
}
